!function(a,b,c){"use strict";b.module("ngResource",["ng"]).factory("$resource",["$http","$parse",function(a,d){function e(a){return f(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function f(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function g(a,b){this.template=a+="#",this.defaults=b||{};var c=this.urlParams={};k(a.split(/\W/),function(b){b&&new RegExp("(^|[^\\\\]):"+b+"\\W").test(a)&&(c[b]=!0)}),this.template=a.replace(/\\:/g,":")}function h(d,e,f){function p(a,b){var c={};return b=l({},e,b),k(b,function(b,d){c[d]=b.charAt&&"@"==b.charAt(0)?o(a,b.substr(1)):b}),c}function q(a){m(a||{},this)}var r=new g(d);return f=l({},i,f),k(f,function(d,e){d.method=b.uppercase(d.method);var f="POST"==d.method||"PUT"==d.method||"PATCH"==d.method;q[e]=function(b,c,e,g){var h,i={},o=j,s=null;switch(arguments.length){case 4:s=g,o=e;case 3:case 2:if(!n(c)){i=b,h=c,o=e;break}if(n(b)){o=b,s=c;break}o=c,s=e;case 1:n(b)?o=b:f?h=b:i=b;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}var t=this instanceof q?this:d.isArray?[]:new q(h);return a({method:d.method,url:r.url(l({},p(h,d.params||{}),i)),data:h}).then(function(a){var b=a.data;b&&(d.isArray?(t.length=0,k(b,function(a){t.push(new q(a))})):m(b,t)),(o||j)(t,a.headers)},s),t},q.prototype["$"+e]=function(a,b,d){var g,h=p(this),i=j;switch(arguments.length){case 3:h=a,i=b,g=d;break;case 2:case 1:n(a)?(i=a,g=b):(h=a,i=b||j);case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var k=f?this:c;q[e].call(this,h,k,i,g)}}),q.bind=function(a){return h(d,l({},e,a),f)},q}var i={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},j=b.noop,k=b.forEach,l=b.extend,m=b.copy,n=b.isFunction,o=function(a,b){return d(b)(a)};return g.prototype={url:function(a){var c,d,g=this,h=this.template;a=a||{},k(this.urlParams,function(f,i){c=a.hasOwnProperty(i)?a[i]:g.defaults[i],b.isDefined(c)&&null!==c?(d=e(c),h=h.replace(new RegExp(":"+i+"(\\W)","g"),d+"$1")):h=h.replace(new RegExp("(/?):"+i+"(\\W)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c})}),h=h.replace(/\/?#$/,"");var i=[];return k(a,function(a,b){g.urlParams[b]||i.push(f(b)+"="+f(a))}),i.sort(),h=h.replace(/\/*$/,""),h+(i.length?"?"+i.join("&"):"")}},h}])}(window,window.angular),function(a,b,c){"use strict";b.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(a,d){function e(){var a,e,f,i;for(a in h)k(g[a])&&d.cookies(a,c);for(a in g)e=g[a],b.isString(e)?e!==h[a]&&(d.cookies(a,e),i=!0):b.isDefined(h[a])?g[a]=h[a]:delete g[a];if(i){i=!1,f=d.cookies();for(a in g)g[a]!==f[a]&&(k(f[a])?delete g[a]:g[a]=f[a],i=!0)}}var f,g={},h={},i=!1,j=b.copy,k=b.isUndefined;return d.addPollFn(function(){var b=d.cookies();f!=b&&(f=b,j(b,h),j(b,g),i&&a.$apply())})(),i=!0,a.$watch(e),g}]).factory("$cookieStore",["$cookies",function(a){return{get:function(c){var d=a[c];return d?b.fromJson(d):d},put:function(c,d){a[c]=b.toJson(d)},remove:function(b){delete a[b]}}}])}(window,window.angular),function(a,b){"use strict";function c(a){var b,c={},d=a.split(",");for(b=0;b<d.length;b++)c[d[b]]=!0;return c}function d(a,c){function d(a,d,g,h){if(d=b.lowercase(d),v[d])for(;q.last()&&w[q.last()];)f("",q.last());u[d]&&q.last()==d&&f("",d),h=r[d]||!!h,h||q.push(d);var i={};g.replace(k,function(a,b,c,d,f){var g=c||d||f||"";i[b]=e(g)}),c.start&&c.start(d,i,h)}function f(a,d){var e,f=0;if(d=b.lowercase(d))for(f=q.length-1;f>=0&&q[f]!=d;f--);if(f>=0){for(e=q.length-1;e>=f;e--)c.end&&c.end(q[e]);q.length=f}}var g,h,p,q=[],s=a;for(q.last=function(){return q[q.length-1]};a;){if(h=!0,q.last()&&x[q.last()])a=a.replace(new RegExp("(.*)<\\s*\\/\\s*"+q.last()+"[^>]*>","i"),function(a,b){return b=b.replace(n,"$1").replace(o,"$1"),c.chars&&c.chars(e(b)),""}),f("",q.last());else if(0===a.indexOf("<!--")?(g=a.indexOf("-->"),g>=0&&(c.comment&&c.comment(a.substring(4,g)),a=a.substring(g+3),h=!1)):m.test(a)?(p=a.match(j),p&&(a=a.substring(p[0].length),p[0].replace(j,f),h=!1)):l.test(a)&&(p=a.match(i),p&&(a=a.substring(p[0].length),p[0].replace(i,d),h=!1)),h){g=a.indexOf("<");var t=0>g?a:a.substring(0,g);a=0>g?"":a.substring(g),c.chars&&c.chars(e(t))}if(a==s)throw"Parse Error: "+a;s=a}f()}function e(a){return B.innerHTML=a.replace(/</g,"&lt;"),B.innerText||B.textContent||""}function f(a){return a.replace(/&/g,"&amp;").replace(q,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function g(a){var c=!1,d=b.bind(a,a.push);return{start:function(a,e,g){a=b.lowercase(a),!c&&x[a]&&(c=a),c||1!=y[a]||(d("<"),d(a),b.forEach(e,function(a,c){var e=b.lowercase(c);1!=A[e]||z[e]===!0&&!a.match(p)||(d(" "),d(c),d('="'),d(f(a)),d('"'))}),d(g?"/>":">"))},end:function(a){a=b.lowercase(a),c||1!=y[a]||(d("</"),d(a),d(">")),a==c&&(c=!1)},chars:function(a){c||d(f(a))}}}var h=function(a){var b=[];return d(a,g(b)),b.join("")},i=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,j=/^<\s*\/\s*([\w:-]+)[^>]*>/,k=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,l=/^</,m=/^<\s*\//,n=/<!--(.*?)-->/g,o=/<!\[CDATA\[(.*?)]]>/g,p=/^((ftp|https?):\/\/|mailto:|#)/i,q=/([^\#-~| |!])/g,r=c("area,br,col,hr,img,wbr"),s=c("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),t=c("rp,rt"),u=b.extend({},t,s),v=b.extend({},s,c("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),w=b.extend({},t,c("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),x=c("script,style"),y=b.extend({},r,v,w,u),z=c("background,cite,href,longdesc,src,usemap"),A=b.extend({},z,c("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,span,start,summary,target,title,type,valign,value,vspace,width")),B=document.createElement("pre");b.module("ngSanitize",[]).value("$sanitize",h),b.module("ngSanitize").directive("ngBindHtml",["$sanitize",function(a){return function(b,c,d){c.addClass("ng-binding").data("$binding",d.ngBindHtml),b.$watch(d.ngBindHtml,function(b){b=a(b),c.html(b||"")})}}]),b.module("ngSanitize").filter("linky",function(){var a=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s\.\;\,\(\)\{\}\<\>]/,b=/^mailto:/;return function(c){if(!c)return c;for(var d,e,f,h=c,i=[],j=g(i);d=h.match(a);)e=d[0],d[2]==d[3]&&(e="mailto:"+e),f=d.index,j.chars(h.substr(0,f)),j.start("a",{href:e}),j.chars(d[0].replace(b,"")),j.end("a"),h=h.substring(f+d[0].length);return j.chars(h),i.join("")}})}(window,window.angular),angular.module("storyConceptApp").controller("MainCtrl",["$scope","$routeParams","VideoFactory",function(a,b,c){a.content=c.query()}]),angular.module("storyConceptApp").factory("VideoFactory",["$resource",function(a){return a("assets/data/:videoId.json",{},{query:{method:"GET",params:{videoId:"videos"},isArray:!0}})}]),angular.module("storyConceptApp").directive("videoStory",function(){return{templateUrl:"templates/videoStory.html",replace:!0,restrict:"E"}}),angular.module("storyConceptApp").directive("videoPlayer",function(){return{templateUrl:"templates/videoPlayer.html",scope:{storyVidSrc:"@",storyImgSrc:"@",videoPlaying:"&",videoStarted:"&",videoPaused:"&",videoEnded:"&",videoUpdate:"&",showHeroVideo:"&",hideHeroVideo:"&",isPlaying:"=",isPaused:"=",isEnded:"=",isMuted:"=",isStarted:"=",isFullscreen:"=",timecodeValue:"=",timecodeText:"="},restrict:"E",link:function(a,b){a.videoPlayback=b.find("video-playback"),a.duration=0,a.currentTime=0,a.timecode=0,a.timecodeText="00:00:00 / 00:00:00",a.canvasContext=null,a.currentCuePoint=null,a.videoIsInViewport=!0,a.$watch("timecodeValue",function(b){void 0!==b&&null!==b&&(a.duration=c(b.duration),a.currentTime=c(b.currentTime),a.timecodeText=a.currentTime+" / "+a.duration,a.videoUpdate({currentTime:b.currentTime,duration:b.duration}))}),a.$watch("isPlaying",function(){a.isPlaying===!0&&(console.log("isPlaying"),a.videoPlaying())}),a.$watch("isPaused",function(){a.isPaused===!0&&console.log("isPaused")}),a.$watch("isMuted",function(){a.isMuted===!0&&console.log("isMuted")}),a.$watch("isEnded",function(){a.isEnded===!0&&console.log("isEnded")}),a.$watch("isStarted",function(){a.isStarted===!0&&console.log("isStarted")}),a.$watch("isFullscreen",function(){console.log("isFullscreen")});var c=function(a){a=Number(a);var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(b>0?b+":":"")+(c>0?(b>0&&10>c?"0":"")+c+":":"0:")+(10>d?"0":"")+d}}}}),angular.module("storyConceptApp").controller("StoryCtrl",["$scope","$routeParams","VideoFactory",function(a,b,c){a.videoIsPlaying=!1,a.videoIsMuted=!1,a.videoTimecodeValue=0,a.videoTimecodeText="",a.currentCuePoint=null,a.floatPlayerVisible=!1,a.video=c.get({videoId:b.storyId},function(b){a.video.title=b.title,a.video.description=b.description,a.video.imageSrc=b.imgSrc,a.video.videoSrc=b.vidSrc,a.video.cuepoints=b.cuepoints,a.video.hasCuepoints=void 0!==a.video.cuepoints&&null!==a.video.cuepoints}),a.videoStarted=function(b){console.log("video started"),console.log("videoElement:"+b),a.setVideoSource(b)},a.videoPlaying=function(){console.log("video playing")},a.videoEnded=function(){console.log("video ended")},a.videoUpdate=function(b,c){if(a.video.hasCuepoints){var d=Math.floor(b),e=Math.floor(c);if(null!==a.currentCuePoint)for(var f=0;f<a.video.cuepoints.length;f++)a.hmsToSeconds(a.video.cuepoints[f].timecode),d===a.hmsToSeconds(a.video.cuepoints[f].timecode)&&(a.currentCuePoint=a.video.cuepoints[f]);else d===a.hmsToSeconds(a.video.cuepoints[0].timecode)&&(a.currentCuePoint=a.video.cuepoints[0]);null!==a.currentCuePoint&&console.log("$scope.currentCuePoint:"+a.currentCuePoint.timecode+" durationToFixed: "+e)}},a.showHeroVideo=function(){console.log("show hero video"),a.floatPlayerVisible===!0&&(a.floatPlayerStopDraw(),a.hideFooter(),a.floatPlayerVisible=!1)},a.hideHeroVideo=function(){console.log("hide hero video"),a.floatPlayerVisible===!1&&(a.floatPlayerDraw(),a.showFooter(),a.floatPlayerVisible=!0)},a.hideFooter=function(){a.$apply(function(){a.floatPlayerVisible=!1})},a.showFooter=function(){a.$apply(function(){a.floatPlayerVisible=!0})},a.hmsToSeconds=function(a){var b=3600*parseInt(a.split(":")[0],10),c=60*parseInt(a.split(":")[1],10),d=parseInt(a.split(":")[2],10);return b+c+d}}]),angular.module("storyConceptApp").directive("floatPlayer",function(){return{templateUrl:"templates/floatPlayer.html",replace:!0,restrict:"E",link:function(a,b){a.canvas=b,a.canvasElem=a.canvas[0],a.canvasContext=a.canvasElem.getContext("2d"),a.vidSource=null;var c=null;a.setVideoSource=function(b){a.vidSource=b},a.floatPlayerDraw=function(){d()},a.floatPlayerStopDraw=function(){e()};var d=function(){if(null!==a.vidSource){if(a.vidSource.paused||a.vidSource.ended)return!1;a.canvasContext.drawImage(a.vidSource,0,0,320,180),c=setTimeout(d,20)}},e=function(){clearTimeout(c)}}}}),angular.module("storyConceptApp").directive("videoControlAudio",function(){return{templateUrl:"templates/videoControlAudio.html",scope:{buttonIsMuted:"="},restrict:"E",link:function(a){a.toggleMute=function(){a.buttonIsMuted=!a.buttonIsMuted}}}}),angular.module("storyConceptApp").directive("videoControlFullscreen",function(){return{templateUrl:"templates/videoControlFullscreen.html",scope:{buttonIsFullscreen:"="},restrict:"E",link:function(a){a.goFullscreen=function(){a.buttonIsFullscreen=!a.buttonIsFullscreen}}}}),angular.module("storyConceptApp").directive("videoControlPlayPauseButton",function(){return{templateUrl:"templates/videoControlPlayPauseButton.html",scope:{buttonIsPlaying:"="},restrict:"E",link:function(a){a.togglePlayPause=function(){a.buttonIsPlaying=!a.buttonIsPlaying}}}}),angular.module("storyConceptApp").directive("videoControlProgressBar",function(){return{scope:{seekToTime:"&",timeBarUpdate:"=",progressBarUpdate:"=",videoPlaybackEnded:"="},templateUrl:"templates/videoControlProgressBar.html",restrict:"E",link:function(a,b){a.progress=0,a.duration=0,a.progressValue=0,a.progressParent=b.children().children(),a.progressBar=$(a.progressParent.children()[0]),a.downloadBar=$(a.progressParent.children()[1]),a.progressBarContainerWidth=0,a.$watch("timeBarUpdate",function(b){if(null!==b&&void 0!==b){var c=Math.floor(b.currentTime/b.duration*100);a.progress=c,a.duration=b.duration,a.progressBar.attr("style","width:"+a.progress+"%")}}),a.$watch("progressBarUpdate",function(b){a.downloadBar.attr("style","width:"+b.downloaded+"%")}),a.handleProgressClick=function(b){0===a.progressBarContainerWidth&&(a.progressBarContainerWidth=b.currentTarget.clientWidth);var c,d;c=Math.round(b.offsetX/a.progressBarContainerWidth*100),d=Math.round(c/100*a.duration);try{a.seekToTime({time:d})}catch(e){console.log("cannot seek to time")}}}}}),angular.module("storyConceptApp").directive("videoControls",function(){return{restrict:"E",scope:{videoControlsIsPlaying:"=",videoControlsIsMuted:"=",videoControlsTimecode:"=",videoControlsIsFullscreen:"="},templateUrl:"templates/videoControls.html"}}),angular.module("storyConceptApp").directive("videoControlTimecodeDisplay",function(){return{templateUrl:"templates/videoControlTimecodeDisplay.html",scope:{videoControlTimecodeDisplayValue:"="},restrict:"E"}}),angular.module("storyConceptApp").directive("videoPlaybackInfoDisplay",function(){return{templateUrl:"templates/videoPlaybackInfoDisplay.html",restrict:"E",link:function(a,b){b.text("this is the videoPlaybackInfoDisplay directive")}}}),angular.module("storyConceptApp").directive("videoPlayback",function(){return{scope:{videoPlaybackTimecode:"=",videoPlaybackIsPlaying:"=",videoPlaybackIsPaused:"=",videoPlaybackIsStarted:"=",videoPlaybackIsEnded:"=",videoPlaybackIsMuted:"=",videoPlaybackIsFullscreen:"=",videoPlaybackVidSrc:"@",videoPlaybackImgSrc:"@"},templateUrl:"templates/videoPlayback.html",restrict:"E",link:function(a,b){function c(a){var b=a.getBoundingClientRect();return b.bottom>=b.height/3&&b.left>=0&&b.height<=(window.innerHeight||document.documentElement.clientHeight)&&b.width<=(window.innerWidth||document.documentElement.clientWidth)}a.videoPlayer=b.find("video"),a.videoElement=a.videoPlayer[0],a.posterImage=b.find("img"),a.showVideoElement=!1,a.showPosterFrame=!0,a.progress=0,a.downloaded=0,a.totalDownloaded=0,a.duration=0,a.currentTime=0,a.timecode=0,a.timecodeText="00:00:00 / 00:00:00",a.timeUpdate=0,a.progressUpdate=0,a.currentCuePoint=null,a.videoPlaybackTimecode=null,a.videoIsInViewport=!0,a.videoPlaybackIsStarted=!1,a.videoPlaybackIsEnded=!1,a.videoPlaybackIsPlaying=!1,a.videoPlaybackIsPaused=!1,a.videoPlaybackIsMuted=!1,a.$watch("videoPlaybackIsPlaying",function(){a.videoPlaybackIsPlaying===!0?a.videoElement.paused===!0&&a.playVideo():a.videoElement.paused===!1&&a.pauseVideo()}),a.$watch("videoPlaybackIsMuted",function(){a.videoPlaybackIsMuted===!0?a.videoElement.muted===!1&&a.muteVideo():a.videoElement.muted===!0&&a.unmuteVideo()}),a.$watch("videoPlaybackIsFullscreen",function(){a.videoPlaybackGoFullscreen()}),a.videoPlayer.bind("ended",function(){a.$apply(function(){a.videoPlaybackIsEnded=!0,a.videoPlaybackIsStarted=!1,a.showVideoElement=!1,a.showPosterFrame=!0})}),a.videoPlayer.bind("play",function(){a.$apply(function(){a.videoPlaybackIsStarted=!0,a.videoPlaybackIsPlaying=!0,a.videoPlaybackIsPaused=!1,a.videoPlaybackIsEnded=!1,a.showVideoElement=!0,a.showPosterFrame=!1})}),a.videoPlayer.bind("pause",function(){a.$apply(function(){a.videoPlaybackIsPlaying=!1,a.videoPlaybackIsPaused=!0})}),a.videoPlayer.bind("volumechange",function(){console.log("scope.muted: "+a.videoElement.muted)}),a.videoPlayer.bind("timeupdate",function(b){a.$apply(function(){a.videoPlaybackTimecode={currentTime:b.srcElement.currentTime,duration:b.srcElement.duration}}),a.videoIsInViewport=c(a.videoElement),a.videoIsInViewport===!0&&a.showPosterFrame===!1?a.showVideoElement=!0:a.hideHeroVideo=!1}),a.videoPlayer.bind("progress",function(b){try{var c=Math.floor(b.srcElement.buffered.end(0)/b.srcElement.duration*100);a.$apply(function(){a.progressUpdate={downloaded:c}})}catch(b){}}),$(window).on("scroll",function(){void 0!==a.vidElem&&null!==a.vidElem&&(a.videoIsInViewport=c(a.vidElem))}),a.playVideo=function(){a.videoElement.play()},a.pauseVideo=function(){a.videoElement.pause()},a.muteVideo=function(){a.videoElement.muted=!0},a.unmuteVideo=function(){a.videoElement.muted=!1},a.seekToTime=function(b){a.videoElement.currentTime=b},a.videoPlaybackGoFullscreen=function(){a.videoElement.mozRequestFullScreen?a.videoElement.mozRequestFullScreen():a.videoElement.webkitRequestFullScreen?a.videoElement.webkitRequestFullScreen():a.videoElement.requestFullScreen&&a.videoElement.requestFullScreen()}}}});