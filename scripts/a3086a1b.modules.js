!function(a,b,c){"use strict";b.module("ngResource",["ng"]).factory("$resource",["$http","$parse",function(a,d){function e(a){return f(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function f(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function g(a,b){this.template=a+="#",this.defaults=b||{};var c=this.urlParams={};k(a.split(/\W/),function(b){b&&new RegExp("(^|[^\\\\]):"+b+"\\W").test(a)&&(c[b]=!0)}),this.template=a.replace(/\\:/g,":")}function h(d,e,f){function p(a,b){var c={};return b=l({},e,b),k(b,function(b,d){c[d]=b.charAt&&"@"==b.charAt(0)?o(a,b.substr(1)):b}),c}function q(a){m(a||{},this)}var r=new g(d);return f=l({},i,f),k(f,function(d,e){d.method=b.uppercase(d.method);var f="POST"==d.method||"PUT"==d.method||"PATCH"==d.method;q[e]=function(b,c,e,g){var h,i={},o=j,s=null;switch(arguments.length){case 4:s=g,o=e;case 3:case 2:if(!n(c)){i=b,h=c,o=e;break}if(n(b)){o=b,s=c;break}o=c,s=e;case 1:n(b)?o=b:f?h=b:i=b;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}var t=this instanceof q?this:d.isArray?[]:new q(h);return a({method:d.method,url:r.url(l({},p(h,d.params||{}),i)),data:h}).then(function(a){var b=a.data;b&&(d.isArray?(t.length=0,k(b,function(a){t.push(new q(a))})):m(b,t)),(o||j)(t,a.headers)},s),t},q.prototype["$"+e]=function(a,b,d){var g,h=p(this),i=j;switch(arguments.length){case 3:h=a,i=b,g=d;break;case 2:case 1:n(a)?(i=a,g=b):(h=a,i=b||j);case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var k=f?this:c;q[e].call(this,h,k,i,g)}}),q.bind=function(a){return h(d,l({},e,a),f)},q}var i={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},j=b.noop,k=b.forEach,l=b.extend,m=b.copy,n=b.isFunction,o=function(a,b){return d(b)(a)};return g.prototype={url:function(a){var c,d,g=this,h=this.template;a=a||{},k(this.urlParams,function(f,i){c=a.hasOwnProperty(i)?a[i]:g.defaults[i],b.isDefined(c)&&null!==c?(d=e(c),h=h.replace(new RegExp(":"+i+"(\\W)","g"),d+"$1")):h=h.replace(new RegExp("(/?):"+i+"(\\W)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c})}),h=h.replace(/\/?#$/,"");var i=[];return k(a,function(a,b){g.urlParams[b]||i.push(f(b)+"="+f(a))}),i.sort(),h=h.replace(/\/*$/,""),h+(i.length?"?"+i.join("&"):"")}},h}])}(window,window.angular),function(a,b,c){"use strict";b.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(a,d){function e(){var a,e,f,i;for(a in h)k(g[a])&&d.cookies(a,c);for(a in g)e=g[a],b.isString(e)?e!==h[a]&&(d.cookies(a,e),i=!0):b.isDefined(h[a])?g[a]=h[a]:delete g[a];if(i){i=!1,f=d.cookies();for(a in g)g[a]!==f[a]&&(k(f[a])?delete g[a]:g[a]=f[a],i=!0)}}var f,g={},h={},i=!1,j=b.copy,k=b.isUndefined;return d.addPollFn(function(){var b=d.cookies();f!=b&&(f=b,j(b,h),j(b,g),i&&a.$apply())})(),i=!0,a.$watch(e),g}]).factory("$cookieStore",["$cookies",function(a){return{get:function(c){var d=a[c];return d?b.fromJson(d):d},put:function(c,d){a[c]=b.toJson(d)},remove:function(b){delete a[b]}}}])}(window,window.angular),angular.module("storyConceptApp").controller("MainCtrl",["$scope","$routeParams","VideoFactory",function(a,b,c){a.content=c.query()}]),angular.module("storyConceptApp").factory("VideoFactory",["$resource",function(a){return a("assets/data/:videoId.json",{},{query:{method:"GET",params:{videoId:"videos"},isArray:!0}})}]),angular.module("storyConceptApp").directive("videoStory",function(){return{templateUrl:"/templates/videoStory.html",replace:!0,restrict:"E",link:function(){}}}),angular.module("storyConceptApp").directive("videoPlayer",function(){return{templateUrl:"/templates/videoPlayer.html",scope:{clickTarget:"&",clickYouTarget:"&",videoStarted:"&",videoPaused:"&",showHeroVideo:"&",hideHeroVideo:"&",onTimeUpdate:"&",title:"@",description:"@",route:"@",vidsource:"@",imgsource:"@"},restrict:"E",replace:!0,link:function(a,b){function c(a){var b=a.getBoundingClientRect();return b.bottom>=b.height/3&&b.left>=0&&b.height<=(window.innerHeight||document.documentElement.clientHeight)&&b.width<=(window.innerWidth||document.documentElement.clientWidth)}var d=!0;a.videoPlayer=b.find("video"),a.posterImage=b.find("img"),a.vidElem=a.videoPlayer[0],a.posterElem=a.posterImage[0],a.canvasContext=null,a.progress=0,a.downloaded=0,a.progressParent=null,a.progressBar=null,a.downloadBar=null,a.progressBarContainerWidth=0,a.totalDownloaded=0,a.duration=0,a.currentTime=0,a.timecode="",a.timecodeText=null,a.currentCuePoint=null,a.videoPlayer.bind("ended",function(){a.videoPlayer.addClass("hidden"),a.posterImage.removeClass("hidden"),a.downloadBar.addClass("hidden")}),a.videoPlayer.bind("volumechange",function(){console.log("scope.muted: "+a.vidElem.muted)}),a.videoPlayer.bind("timeupdate",function(b){null===a.progressBar&&(a.progressBar=$("#progress-bar")),null===a.timecodeText&&(a.timecodeText=$("#timecode-text"));var c=Math.floor(b.srcElement.currentTime/b.srcElement.duration*100);a.progress=c,a.duration=e(a.vidElem.duration),a.currentTime=e(a.vidElem.currentTime),a.timecode=a.currentTime+" / "+a.duration,a.progressBar.attr("style","width:"+a.progress+"%"),a.timecodeText.text(a.timecode),c>0&&a.downloadBar.removeClass("hidden"),d===!0?a.showHeroVideo():a.hideHeroVideo(),a.onTimeUpdate({currentTime:b.srcElement.currentTime,duration:b.srcElement.duration})}),a.videoPlayer.bind("progress",function(b){null===a.downloadBar&&(a.downloadBar=$("#download-bar")),null===a.progressParent&&(a.progressParent=$("#progress-parent"));try{var c=Math.floor(b.srcElement.buffered.end(0)/b.srcElement.duration*100);a.downloaded=c,a.downloadBar.attr("style","width:"+a.downloaded+"%")}catch(b){}}),$(window).on("scroll",function(){void 0!==a.vidElem&&null!==a.vidElem&&(d=c(a.vidElem))}),a.playVideo=function(){a.posterImage.addClass("hidden"),a.videoPlayer.removeClass("hidden"),a.vidElem.play();var b=a.vidElem;a.videoStarted({videoElement:b})},a.pauseVideo=function(){a.vidElem.pause(),a.videoPaused()},a.muteVideo=function(){a.vidElem.muted=!0},a.unmuteVideo=function(){a.vidElem.muted=!1},a.goFullscreen=function(){a.vidElem.mozRequestFullScreen?a.vidElem.mozRequestFullScreen():a.vidElem.webkitRequestFullScreen?a.vidElem.webkitRequestFullScreen():a.vidElem.requestFullScreen&&a.vidElem.requestFullScreen()},a.handleProgressClick=function(b){0===a.progressBarContainerWidth&&(a.progressBarContainerWidth=b.currentTarget.clientWidth);var c,d;c=Math.round(b.offsetX/a.progressBarContainerWidth*100),d=Math.round(c/100*a.vidElem.duration);try{a.vidElem.currentTime=d}catch(e){}};var e=function(a){a=Number(a);var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(b>0?b+":":"")+(c>0?(b>0&&10>c?"0":"")+c+":":"0:")+(10>d?"0":"")+d}}}}),angular.module("storyConceptApp").controller("StoryCtrl",["$scope","$routeParams","VideoFactory",function(a,b,c){a.video=c.get({videoId:b.storyId},function(b){a.video.title=b.title,a.video.description=b.description,a.video.imageSrc=b.imgSrc,a.video.videoSrc=b.vidSrc,a.video.cuepoints=b.cuepoints,a.video.hasCuepoints=void 0!==a.video.cuepoints&&null!==a.video.cuepoints}),a.currentCuePoint=null,a.floatPlayerVisible=!1,a.videoStarted=function(b){console.log("video started"),console.log("videoElement:"+b),a.setVideoSource(b)},a.videoEnded=function(){console.log("video ended")},a.videoUpdate=function(b,c){if(a.video.hasCuepoints){console.log("currentTime:"+Math.floor(b)),console.log("duration:"+Math.floor(c));var d=Math.floor(b);if(null!==a.currentCuePoint)for(var e=0;e<a.video.cuepoints.length;e++)a.hmsToSeconds(a.video.cuepoints[e].timecode),d===a.hmsToSeconds(a.video.cuepoints[e].timecode)&&a.applyCuePoint(a.video.cuepoints[e]);else d===a.hmsToSeconds(a.video.cuepoints[0].timecode)&&a.applyCuePoint(a.video.cuepoints[0]);null!==a.currentCuePoint&&console.log("$scope.currentCuePoint:"+a.currentCuePoint.timecode)}},a.applyCuePoint=function(b){a.$apply(function(){a.currentCuePoint=b})},a.showHeroVideo=function(){console.log("show hero video"),a.floatPlayerVisible===!0&&(a.floatPlayerStopDraw(),a.hideFooter(),a.floatPlayerVisible=!1)},a.hideHeroVideo=function(){console.log("hide hero video"),a.floatPlayerVisible===!1&&(a.floatPlayerDraw(),a.showFooter(),a.floatPlayerVisible=!0)},a.hideFooter=function(){a.$apply(function(){a.floatPlayerVisible=!1})},a.showFooter=function(){a.$apply(function(){a.floatPlayerVisible=!0})},a.hmsToSeconds=function(a){var b=3600*parseInt(a.split(":")[0],10),c=60*parseInt(a.split(":")[1],10),d=parseInt(a.split(":")[2],10);return b+c+d}}]),angular.module("storyConceptApp").directive("floatPlayer",function(){return{templateUrl:"/templates/floatPlayer.html",replace:!0,restrict:"E",link:function(a,b){a.canvas=b,a.canvasElem=a.canvas[0],a.canvasContext=a.canvasElem.getContext("2d"),a.vidSource=null;var c=null;a.setVideoSource=function(b){a.vidSource=b},a.floatPlayerDraw=function(){d()},a.floatPlayerStopDraw=function(){e()};var d=function(){if(null!==a.vidSource){if(a.vidSource.paused||a.vidSource.ended)return!1;a.canvasContext.drawImage(a.vidSource,0,0,320,180),c=setTimeout(d,20)}},e=function(){clearTimeout(c)}}}});